<Window x:Class="PhotoMax.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="PhotoMax"
        Icon="/assets/photomax-icon.ico"
        Height="720"
        Width="1120"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource PmWindowBackgroundBrush}"
        Foreground="{StaticResource PmTextBrush}">
    <DockPanel>

        <!-- TOP MENU: only File kept -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New" Click="File_New_Click"/>
                <Separator/>
                <MenuItem Header="_Open..." Click="File_Open_Click"/>
                <Separator/>
                <MenuItem Header="_Save" Click="File_Save_Click"/>
                <MenuItem Header="Save _As..." Click="File_SaveAs_Click"/>
                <Separator/>
                <MenuItem Header="_Properties" Click="File_Properties_Click"/>
                <Separator/>
                <MenuItem Header="_Quit" Click="File_Quit_Click"/>
            </MenuItem>
        </Menu>

        <!-- STATUS BAR -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem Content="Ready" x:Name="StatusText"/>
        </StatusBar>

        <!-- MAIN WORKSPACE -->
        <ScrollViewer x:Name="Scroller"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      CanContentScroll="False"
                      ClipToBounds="True"
                      PreviewMouseWheel="Scroller_PreviewMouseWheel"
                      PreviewMouseDown="Scroller_PreviewMouseDown"
                      PreviewMouseMove="Scroller_PreviewMouseMove"
                      PreviewMouseUp="Scroller_PreviewMouseUp"
                      PreviewKeyDown="Scroller_PreviewKeyDown"
                      PreviewKeyUp="Scroller_PreviewKeyUp">

            <Grid x:Name="Root">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="230"/>   <!-- Left sidebar -->
                    <ColumnDefinition Width="*"/>     <!-- Center canvas -->
                    <ColumnDefinition Width="280"/>   <!-- Right sidebar -->
                </Grid.ColumnDefinitions>

                <!-- ========== LEFT SIDEBAR: COLOR + TOOLS + FILTERS ========== -->
                <Border Grid.Column="0"
                        Background="{StaticResource PmPanelBackgroundBrush}"
                        BorderBrush="{StaticResource PmPanelBorderBrush}"
                        BorderThickness="0,0,1,0">
                    <StackPanel Margin="10">

                        <!-- COLOR PICKER -->
                        <TextBlock Text="COLOR"
                                   FontSize="10"
                                   Margin="2,0,0,4"
                                   Foreground="{StaticResource PmSubTextBrush}"
                                   FontWeight="Bold"/>
                        <Button x:Name="ColorSwatch"
                                Click="Tool_ColorPicker_Click"
                                Width="84"
                                Height="84"
                                Background="{StaticResource PmAccentBrush}"
                                BorderBrush="{StaticResource PmAccentBrushSoft}"
                                BorderThickness="1"
                                Margin="0,0,0,8">
                            <StackPanel>
                                <TextBlock Text="🎨"
                                           FontSize="26"
                                           HorizontalAlignment="Center"
                                           Foreground="White"/>
                                <TextBlock Text="Pick color"
                                           FontSize="11"
                                           HorizontalAlignment="Center"
                                           Foreground="White"/>
                            </StackPanel>
                        </Button>

                        <Separator Margin="0,10,0,8"/>

                        <!-- TOOLS -->
                        <TextBlock Text="TOOLS"
                                   FontSize="10"
                                   Margin="2,0,0,4"
                                   Foreground="{StaticResource PmSubTextBrush}"
                                   FontWeight="Bold"/>

                        <StackPanel>
                            <Button Click="Tool_Brushes_Click" ToolTip="Paint brush">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="✏"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Brush"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Tool_Erase_Click" ToolTip="Toggle eraser">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⌫"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Eraser"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Colors_BrushSize_Click" ToolTip="Cycle brush size">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⬚"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Brush size"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Tool_MoveTool_Click" ToolTip="Move tool / pan">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="☩"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Move tool"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Tool_TextBox_Click" ToolTip="Add text box">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="T"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Text box"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Shapes_List_Click" ToolTip="Shapes">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⬚"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Shapes"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Fun_Filters_Click" ToolTip="Fun filters toolbar">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="✨"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Fun filters"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <Separator Margin="0,10,0,8"/>

                        <!-- LAYER FILTERS (Tools.cs filters) -->
                        <TextBlock Text="LAYER FILTERS"
                                   FontSize="10"
                                   Margin="2,0,0,4"
                                   Foreground="{StaticResource PmSubTextBrush}"
                                   FontWeight="Bold"/>

                        <StackPanel>
                            <Button Click="Filter_Gaussian_Click" ToolTip="Gaussian blur">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="σ"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Gaussian"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Filter_Sobel_Click" ToolTip="Sobel edges">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="∂"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Sobel"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Filter_Binary_Click" ToolTip="Binary threshold">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="01"
                                               FontSize="12"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Binary"/>
                                </StackPanel>
                            </Button>

                            <Button Click="Filter_HistogramThreshold_Click" ToolTip="Histogram/Otsu">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="▤"
                                               FontSize="14"
                                               Foreground="{StaticResource PmGlyphBrush}"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="Histogram thres."/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- ========== CENTER: ARTBOARD / CANVAS ========== -->
                <Border x:Name="Workbench"
                        Grid.Column="1"
                        Background="{StaticResource PmWindowBackgroundBrush}"
                        Padding="0">
                    <Grid x:Name="Workspace"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          RenderTransformOrigin="0.5,0.5">

                        <!-- ≤100% zoom -->
                        <Grid.RenderTransform>
                            <ScaleTransform x:Name="RenderScale" ScaleX="1" ScaleY="1"/>
                        </Grid.RenderTransform>

                        <!-- >100% zoom -->
                        <Grid.LayoutTransform>
                            <ScaleTransform x:Name="LayoutScale" ScaleX="1" ScaleY="1"/>
                        </Grid.LayoutTransform>

                        <!-- Artboard with drop shadow -->
                        <Border Background="{StaticResource PmPanelBackgroundBrush}"
                                BorderBrush="{StaticResource PmPanelBorderBrush}"
                                BorderThickness="1">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="6"
                                                  BlurRadius="14"
                                                  Opacity="0.7"/>
                            </Border.Effect>

                            <Grid x:Name="ArtboardHost">
                                <Canvas x:Name="Artboard"
                                        Background="#202020"
                                        Width="1280"
                                        Height="720">
                                    <Image x:Name="ImageView"
                                           Width="{Binding ElementName=Artboard, Path=Width}"
                                           Height="{Binding ElementName=Artboard, Path=Height}"
                                           Stretch="Fill"
                                           AllowDrop="True"
                                           Drop="ImageView_Drop"/>
                                    <InkCanvas x:Name="PaintCanvas"
                                               Width="{Binding ElementName=Artboard, Path=Width}"
                                               Height="{Binding ElementName=Artboard, Path=Height}"
                                               Background="Transparent"/>
                                </Canvas>

                                <!-- Grid overlay -->
                                <Rectangle x:Name="GridOverlay"
                                           Width="{Binding ElementName=Artboard, Path=Width}"
                                           Height="{Binding ElementName=Artboard, Path=Height}"
                                           IsHitTestVisible="False"
                                           Opacity="0.8"
                                           Visibility="Visible"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- ========== RIGHT SIDEBAR: SELECTION, TRANSFORM, LAYERS, GRID, CLIPBOARD, ZOOM ========== -->
                <Border Grid.Column="2"
                        Background="{StaticResource PmPanelBackgroundBrush}"
                        BorderBrush="{StaticResource PmPanelBorderBrush}"
                        BorderThickness="1,0,0,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel Margin="10">

                            <!-- SELECTION -->
                            <TextBlock Text="SELECTION"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Click="Select_Rect_Click" ToolTip="Rectangular selection" Margin="0,0,4,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="▭"
                                                   FontSize="14"
                                                   Foreground="{StaticResource PmGlyphBrush}"
                                                   Margin="0,0,4,0"/>
                                        <TextBlock Text="Rect"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="Select_Lasso_Click" ToolTip="Free-form (lasso)" Margin="0,0,4,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="◌"
                                                   FontSize="14"
                                                   Foreground="{StaticResource PmGlyphBrush}"
                                                   Margin="0,0,4,0"/>
                                        <TextBlock Text="Lasso"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="Select_Polygon_Click" ToolTip="Polygon selection">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="△"
                                                   FontSize="14"
                                                   Foreground="{StaticResource PmGlyphBrush}"
                                                   Margin="0,0,4,0"/>
                                        <TextBlock Text="Poly"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <!-- Crop & Resize -->
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <Button Click="Image_Crop_Click" ToolTip="Crop to selection" Margin="0,0,4,0">
                                    <TextBlock Text="Crop"/>
                                </Button>
                                <Button Click="Image_Resize_Click" ToolTip="Resize image">
                                    <TextBlock Text="Resize"/>
                                </Button>
                            </StackPanel>

                            <Separator Margin="0,10,0,8"/>

                            <!-- TRANSFORM (rotate/flip) -->
                            <TextBlock Text="TRANSFORM"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <WrapPanel>
                                <Button Click="Rotate_Right_Click" ToolTip="Rotate right 90°" Margin="0,0,4,4">
                                    <TextBlock Text="⟳ 90°"/>
                                </Button>
                                <Button Click="Rotate_Left_Click" ToolTip="Rotate left 90°" Margin="0,0,4,4">
                                    <TextBlock Text="⟲ 90°"/>
                                </Button>
                                <Button Click="Flip_Vert_Click" ToolTip="Flip vertical" Margin="0,0,4,4">
                                    <TextBlock Text="Flip V"/>
                                </Button>
                                <Button Click="Flip_Horiz_Click" ToolTip="Flip horizontal" Margin="0,0,4,4">
                                    <TextBlock Text="Flip H"/>
                                </Button>
                            </WrapPanel>

                            <Separator Margin="0,10,0,8"/>

                            <!-- LAYERS -->
                            <TextBlock Text="LAYERS"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <WrapPanel>
                                <Button Click="Layers_New_Click" ToolTip="New layer" Margin="0,0,4,4">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="+"
                                                   FontSize="14"
                                                   Foreground="{StaticResource PmGlyphBrush}"
                                                   Margin="0,0,4,0"/>
                                        <TextBlock Text="New"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="Layers_Load_Click" ToolTip="Load layer" Margin="0,0,4,4">
                                    <TextBlock Text="Load"/>
                                </Button>
                                <Button Click="Layers_Edit_Click" ToolTip="Edit layer" Margin="0,0,4,4">
                                    <TextBlock Text="Edit"/>
                                </Button>
                                <Button Click="Layers_Select_Click" ToolTip="Select layer" Margin="0,0,4,4">
                                    <TextBlock Text="Select"/>
                                </Button>
                                <Button Click="Layers_Rename_Click" ToolTip="Rename layer" Margin="0,0,4,4">
                                    <TextBlock Text="Rename"/>
                                </Button>
                                <Button Click="Layers_Delete_Click" ToolTip="Delete layer" Margin="0,0,4,4">
                                    <TextBlock Text="Delete"/>
                                </Button>
                            </WrapPanel>

                            <Separator Margin="0,10,0,8"/>

                            <!-- GRID -->
                            <TextBlock Text="GRID"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Click="View_ToggleGrid_Click" ToolTip="Toggle grid" Margin="0,0,4,0">
                                    <TextBlock Text="Toggle"/>
                                </Button>
                                <Button Click="View_GridSettings_Click" ToolTip="Grid settings">
                                    <TextBlock Text="Settings"/>
                                </Button>
                            </StackPanel>

                            <Separator Margin="0,10,0,8"/>

                            <!-- CLIPBOARD -->
                            <TextBlock Text="CLIPBOARD"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Click="Clipboard_Copy_Click" ToolTip="Copy" Margin="0,0,4,0">
                                    <TextBlock Text="Copy"/>
                                </Button>
                                <Button Click="Clipboard_Cut_Click" ToolTip="Cut" Margin="0,0,4,0">
                                    <TextBlock Text="Cut"/>
                                </Button>
                                <Button Click="Clipboard_Paste_Click" ToolTip="Paste">
                                    <TextBlock Text="Paste"/>
                                </Button>
                            </StackPanel>

                            <Separator Margin="0,10,0,8"/>

                            <!-- ZOOM -->
                            <TextBlock Text="ZOOM"
                                       FontSize="10"
                                       Margin="2,0,0,4"
                                       Foreground="{StaticResource PmSubTextBrush}"
                                       FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Click="Zoom_Out_Click" ToolTip="Zoom out" Margin="0,0,4,0">
                                    <TextBlock Text="-"/>
                                </Button>
                                <Button Click="Zoom_100_Click" ToolTip="Zoom 100%" Margin="0,0,4,0">
                                    <TextBlock Text="100%"/>
                                </Button>
                                <Button Click="Zoom_In_Click" ToolTip="Zoom in" Margin="0,0,4,0">
                                    <TextBlock Text="+"/>
                                </Button>
                                <Button Click="Zoom_Fit_Click" ToolTip="Zoom to fit">
                                    <TextBlock Text="Fit"/>
                                </Button>
                            </StackPanel>

                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </ScrollViewer>

    </DockPanel>
</Window>
